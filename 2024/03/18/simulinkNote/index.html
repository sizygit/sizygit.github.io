

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/fluid.png">
  <link rel="icon" href="../../../../img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="szy">
  <meta name="keywords" content="">
  
    <meta name="description" content="Simulink常用工具StateFlow概述​		Stateflow 图是有限状态机的图形表示，由状态、转移和数据组成。您可以创建 Stateflow 图来定义 MATLAB 算法或 Simulink模型如何响应外部输入信号、事件和基于时间的条件。Stateflow 编辑器是一个图形环境，用于设计状态转移图、流程图、状态转移表和真值表。在打开 Stateflow 编辑器之前，需要先确定最能满足您">
<meta property="og:type" content="article">
<meta property="og:title" content="simulinkNote">
<meta property="og:url" content="http://example.com/2024/03/18/simulinkNote/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Simulink常用工具StateFlow概述​		Stateflow 图是有限状态机的图形表示，由状态、转移和数据组成。您可以创建 Stateflow 图来定义 MATLAB 算法或 Simulink模型如何响应外部输入信号、事件和基于时间的条件。Stateflow 编辑器是一个图形环境，用于设计状态转移图、流程图、状态转移表和真值表。在打开 Stateflow 编辑器之前，需要先确定最能满足您">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/stateflow1.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E5%8C%85%E5%90%AB%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E5%8C%85%E5%90%AB%E5%AD%90%E7%B3%BB%E7%BB%9F.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E5%B9%B6%E8%A1%8C.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E8%BE%93%E5%87%BA.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E5%BE%AA%E7%8E%AF%E8%B0%83%E5%BA%A6%E5%99%A8.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E7%9B%91%E8%A7%86%E7%8A%B6%E6%80%81.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81%E6%95%B0%E6%8D%AE.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/image-20230619190121382.png">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/Mamdani%E6%A8%A1%E7%B3%8A%E9%80%BB%E8%BE%91%E7%AE%97%E6%B3%95.PNG">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/T-S%E6%A8%A1%E7%B3%8A%E9%80%BB%E8%BE%91%E7%AE%97%E6%B3%95.PNG">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/T-S%E5%9E%8BMF%E8%BE%93%E5%87%BA%E7%95%8C%E9%9D%A2.PNG">
<meta property="og:image" content="http://example.com/2024/03/18/simulinkNote/MATLAB%E6%A8%A1%E7%B3%8A%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F%E7%A4%BA%E4%BE%8B.PNG">
<meta property="article:published_time" content="2024-03-18T05:51:52.000Z">
<meta property="article:modified_time" content="2024-03-28T14:57:00.314Z">
<meta property="article:author" content="szy">
<meta property="article:tag" content="simulink">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2024/03/18/simulinkNote/stateflow1.png">
  
  
  
  <title>simulinkNote - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="../../../../css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="../../../../css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="../../../../css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":40,"cursorChar":".","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="../../../../js/utils.js" ></script>
  <script  src="../../../../js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="../../../../index.html">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../index.html">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('../../../../img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="simulinkNote"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-18 13:51" pubdate>
          2024年3月18日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          127 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">simulinkNote</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Simulink常用工具"><a href="#Simulink常用工具" class="headerlink" title="Simulink常用工具"></a>Simulink常用工具</h1><h2 id="StateFlow"><a href="#StateFlow" class="headerlink" title="StateFlow"></a>StateFlow</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>​		Stateflow 图是有限状态机的图形表示，由状态、转移和数据组成。您可以创建 Stateflow 图来定义 MATLAB 算法或 Simulink模型如何响应外部输入信号、事件和基于时间的条件。Stateflow 编辑器是一个图形环境，用于设计状态转移图、流程图、状态转移表和真值表。在打开 Stateflow 编辑器之前，需要先确定最能满足您需求的图执行模式。</p>
<ul>
<li><p>要建立周期性或连续时间 Simulink 算法的条件、基于事件和基于时间的逻辑模型，直接在simulink中导入<code>chart</code>模块。</p>
</li>
<li><p>要为 MATLAB 应用程序设计可重用的状态机和时序逻辑，请使用 <a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/ref/edit.html"><code>edit</code></a> 函数创建可作为 MATLAB 对象执行的独立 Stateflow 图。在 MATLAB 命令提示符处，输入：</p>
  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">edit sfDemo.sfx  <span class="hljs-comment">% create chart for execution as a MATLAB object</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>​		Stateflow编辑器主要包括图画布、对象选项板和符号图窗；图画布是表示Stateflow的绘图区域，左侧的对象选项板是可添加图形元素的工具（空格键可自动自适应大小），右侧的符号图窗则是用来添加或编辑数据、时间和消息的工具，如下图：</p>
<p><img src="/2024/03/18/simulinkNote/stateflow1.png" srcset="/img/loading.gif" lazyload></p>
<p>​		最简单的<code>State</code>模块可用左键拖出，可定义状态名称与状态动作；同时可以在不同的状态间绘制状态转移线，在线上可添加不同的事件名称、转移条件及动作。<code>Juction</code>通常是作为分支逻辑和条件判断的选择点；<code>Default transition</code>模块则是默认选择子状态的转移线。通常运行需定义图中所有符号的作用域（如输入数据、输出数据或常量数据），通过点击左侧对应的type图表进行修改。</p>
<h3 id="状态与转移"><a href="#状态与转移" class="headerlink" title="状态与转移"></a>状态与转移</h3><p>​		Stateflow的状态名称由字母数字和下划线字符组合而成，相关规范及保留关键字细节可参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/rules-for-naming-stateflow-objects.html">Stateflow命名规范</a>。状态内需要定义不同的状态动作，状态动作主要包括entry(en)、during(du)、exit(ex)、on、bind几种类型，通常使用**typename :**后接相应的动作语句，如果直接在状态名称后添加语句，图会将这些语句解释为组合的 <code>entry</code> 和 <code>during</code> 动作。</p>
<ul>
<li><strong>entry</strong>：状态起始被激活时执行，通常用于执行初始化或准备工作。</li>
<li><strong>during</strong>：状态被起始激活后(上一周期时间步执行过<code>entry</code>)且没有到另一个状态的有效转移时执行。</li>
<li><strong>exit</strong>：状态被激活且发生转出状态的转移时执行。</li>
<li><strong>on</strong>：状态被激活且接收到指定的事件或消息时执行，可参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/how-events-work-in-stateflow-charts.html">通过广播事件同步模型组件</a>和<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/message-syntax-in-charts.html">通过发送消息与 Stateflow 图通信</a>。</li>
<li><strong>bind</strong>：用于将变量或参数绑定到不同的作用域，以实现数据共享或更改。</li>
</ul>
<p>​		状态的转移与计算可参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/chart-initialization-and-entry-actions.html">进入图或状态</a>，<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/evaluate-transitions.html">计算转移</a>。<strong>默认转移</strong>是一种没有源的转移。在不包含任何状态的 Stateflow 图中，默认转移标记流程图（子图）的开始，图（子图）仅在进入状态时计算状态内的默认转移路径，而不是在图每次唤醒时计算。<strong>外部转移</strong>是一种退出源状态的转移，需要使用使用状态之间的转移箭头，Stateflow 图将标记待计算的外部转移作为执行状态的<strong>第一步</strong>，没有有效的外部转移才会执行该状态的<code>during</code>。<strong>内部转移</strong>是一种不退出源状态的转移，（参阅<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/inner-transitions.html">Control Chart Execution by Using Inner Transitions</a>），当前状态执行<code>during</code>后会标记待计算的内部转移。通常的转移标签类型为</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">(Event/<span class="hljs-keyword">Message</span> <span class="hljs-keyword">name</span>)[Condition]<span class="hljs-comment">&#123;ConditionAction&#125;</span> <br></code></pre></td></tr></table></figure>

<p><code>Condition</code> 是布尔表达式，用于确定是否发生转移。如果不指定条件，转移将在源状态被激活后的<strong>下一个时间步</strong>发生。在转移标签语法中，若转移动作以<strong>正斜杠 (<code>/</code>) 开头</strong>，并括在花括号前 (<code>/&#123;action&#125;</code>)，仅在转移路径确定为有效后，转移动作才会执行（在转移含有条件与动作时下需要避免计算回溯）。 <code>ConditionAction</code> 是在判断转移的条件为 true 时执行的指令。条件动作发生在条件后，但在任何 <code>exit</code> 或 <code>entry</code> 状态动作之前。Stateflow中含有内置的<strong>隐式事件</strong>，可参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/using-implicit-events.html">通过使用隐式事件控制图行为</a>。</p>
<h3 id="子系统与子图"><a href="#子系统与子图" class="headerlink" title="子系统与子图"></a>子系统与子图</h3><p>​		类似子系统，也可在Stateflow中创建子图和子状态，创建子状态，请点击状态工具，将新状态拖到要作为其父状态的状态中。当父状态被激活时，子状态之一也被激活。当父状态变为非激活时，所有子状态都变为非激活。在一个时间步长内，<strong>初始化</strong>时父状态被激活时，会优先执行entry（初始化），若无<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/recording-state-activity-with-history-junctions.html">历史节点</a>则通过<strong>默认转移</strong>到子状态执行<code>entry</code>；初始化后若图<strong>再次被唤醒</strong>，首先判断父状态的的外部转移，无有效转移执行父状态的<code>during</code>，之后在被激活的子状态中执行转移或<code>during</code>等。</p>
<p>​		一个包含子系统的图初始化如下：</p>
<img src="/2024/03/18/simulinkNote/包含子系统的初始化.png" srcset="/img/loading.gif" lazyload style="zoom:85%;">

<p>​		一个包含子系统的执行流程如下：</p>
<p><img src="/2024/03/18/simulinkNote/%E5%8C%85%E5%90%AB%E5%AD%90%E7%B3%BB%E7%BB%9F.png" srcset="/img/loading.gif" lazyload></p>
<p>​		如果您需要 Stateflow 图记住并返回到以前激活的子状态，而不考虑默认转移，则应使用<strong>历史结点</strong>。将历史结点置于某状态之内会覆盖指向互斥  (OR) 子状态的默认转移。在将历史结点置于某状态内后，在执行 entry 动作时，您的 Stateflow  图会记住并进入先前激活的子状态。历史结点只会应用到层次结构中其所在的层级。</p>
<h3 id="使用状态分解设置子系统的互斥与并行"><a href="#使用状态分解设置子系统的互斥与并行" class="headerlink" title="使用状态分解设置子系统的互斥与并行"></a>使用状态分解设置子系统的互斥与并行</h3><p>​		图或状态的分解类型指定图或状态包含互斥状态还是并行状态：<strong>互斥状态</strong>表示互斥的工作模式，同一层级上不能有两个互斥状态同时被激活或执行。Stateflow 图用实线矩形表示每个互斥状态。<strong>并行状态</strong>表示独立的工作模式，虽然并行状态会依次执行，但可以有两个或多个并行状态同时处于激活状态，Stateflow 图用虚线矩形表示每个并行状态，其中的数字表示其执行顺序。</p>
<p>​		子状态的外观指示其父状态的分解，同时需显式指定并行顺序（参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/execution-order-for-parallel-states.html">并行状态的执行顺序</a>），如下：</p>
<p><img src="/2024/03/18/simulinkNote/%E5%B9%B6%E8%A1%8C.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="通过广播事件同步并行状态"><a href="#通过广播事件同步并行状态" class="headerlink" title="通过广播事件同步并行状态"></a>通过广播事件同步并行状态</h3><p>​		<strong>局部事件</strong>允许一个状态触发同一个 Stateflow图中另一个状态的转移或动作，从而使您能够<strong>协调并行状态</strong>。要将事件从一个状态广播到另一个状态，请使用 <code>send</code> 运算符以及事件的名称和激活状态的名称：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">send(eventName,stateName)<br></code></pre></td></tr></table></figure>

<p>当您广播事件时，该事件将在接收状态以及该状态层次结构中的任何子状态中均生效，注意广播的该事件通常只作用于本次时间步内。局部事件为固定事件类型，无需设置。</p>
<p>​		Stateflow还可以与图外部的事件进行交互，如<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/using-input-events-to-activate-a-stateflow-chart.html">接受输入事件</a>或<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/using-output-events-to-activate-a-simulink-block.html">输出事件</a>。</p>
<p>​		<strong>输出事件</strong>直接使用<code>send(eventName)</code>来广播，每个输出事件对应一个输出端口，在Modeling-Symbols Pane新建对应事件并将其设置为Output Event，右键打开事件的Inspector可配置输出事件<code>Trigger</code>属性，可设置为Either Edge（边沿触发）或Function call（函数调用）两种，均可用来传递或激活其他simulink模块，例如<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/ug/triggered-subsystems.html">触发子系统</a>或<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/ug/using-function-call-subsystems.html">函数调用子系统</a>。	</p>
<ul>
<li>Either Edge：会输出0-1的上升下降沿，触发子系统可以读取上升或者下降沿，或者Either Edge，可作为常量显示。对于每个时间步，图<strong>仅调度</strong>边沿触发输出事件的<strong>一个广播</strong>，若多次广播一个事件时，图只会广播一次该事件，在后续时间步中继续广播该事件（信号0-1的限制）。</li>
</ul>
<p><img src="/2024/03/18/simulinkNote/%E8%BE%93%E5%87%BA.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>Function call：输出函数调用事件会激活 Simulink 模块，使其在仿真的当前时间步内执行。这种类型的输出事件只对可以使用函数调用触发的模块有效，可参阅<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/ug/using-function-call-subsystems.html">使用函数调用子系统</a> (Simulink)。当单个时间步中存在某一函数调用输出事件的多个广播时，图会在该时间步内<strong>调度所有广播</strong>（<strong>与边沿触发不同</strong>）。函数调用子系统的执行与图的执行<strong>交叉进行</strong>，因此<strong>函数调用子系统的输出可立即在图中使用</strong>。基于此特性，可以设计一个循环调度器，从而能在一个时间步多次执行函数调用子系统，如下：</li>
</ul>
<p><img src="/2024/03/18/simulinkNote/%E5%BE%AA%E7%8E%AF%E8%B0%83%E5%BA%A6%E5%99%A8.png" srcset="/img/loading.gif" lazyload></p>
<p>​		使用<strong>输入事件</strong>激活Stateflow图，只需要在Symbols中添加一个Input Event，可以将触发器属性设置为上升、下降沿或函数调用。在任意给定时间步，按其端口号升序检查输入事件。对于边沿触发输入事件，同一时间步内可能会出现多个边沿，这会在该时间步内将 Stateflow  图唤醒多次。在这种情况下，事件按其端口号的升序顺序唤醒 Stateflow 图。</p>
<h3 id="使用状态激活数据监视图活动"><a href="#使用状态激活数据监视图活动" class="headerlink" title="使用状态激活数据监视图活动"></a>使用状态激活数据监视图活动</h3><p>​		Stateflow图中的状态在运行时可以实时显示当前状态，为了更为直观分析状态的转移历史，我们可以通过Data Inspector来记录状态值。Data Inspector可以记录局部数据、输出数据的数值，还可以用来记录状态的activity，如下：</p>
<p><img src="/2024/03/18/simulinkNote/%E7%9B%91%E8%A7%86%E7%8A%B6%E6%80%81.png" srcset="/img/loading.gif" lazyload></p>
<p>​		如果 Stateflow 图包含与图层次结构相关的数据，则可以使用活动状态数据( <strong>Active State Data</strong>)来简化设计，Stateflow通过输出端口将状态活动报告给Simulink或用作图表中的本地数据。激活状态数据有三种类型：</p>
<table>
<thead>
<tr>
<th>Activity Type</th>
<th>Active State Data Type</th>
</tr>
</thead>
<tbody><tr>
<td>Self activity</td>
<td>Boolean</td>
</tr>
<tr>
<td>Child activity</td>
<td>[Enumeration]( <a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ug/about-active-state-data.html#bt5zn9j-1">Define State Activity Enumeration Type</a>.)</td>
</tr>
<tr>
<td>Leaf state activity</td>
<td>Enumeration</td>
</tr>
</tbody></table>
<p>​		您可以为状态流图、状态、状态转换表或原子子图启用活动状态数据，下表列出了每种状态流对象支持的活动类型。</p>
<table>
<thead>
<tr>
<th>Stateflow Object</th>
<th>Self-Activity</th>
<th>Child Activity</th>
<th>Leaf State Activity</th>
</tr>
</thead>
<tbody><tr>
<td>Charts</td>
<td>Not supported</td>
<td>Supported</td>
<td>Supported</td>
</tr>
<tr>
<td>States with exclusive (OR) decomposition</td>
<td>Supported</td>
<td>Supported</td>
<td>Supported</td>
</tr>
<tr>
<td>States with parallel (AND) decomposition</td>
<td>Supported</td>
<td>Not supported</td>
<td>Not supported</td>
</tr>
<tr>
<td>Atomic subcharts</td>
<td>Supported at the container level</td>
<td>Supported inside the subchart</td>
<td>Supported inside the subchart</td>
</tr>
<tr>
<td>State transition tables</td>
<td>Not supported</td>
<td>Supported</td>
<td>Supported</td>
</tr>
</tbody></table>
<p><img src="/2024/03/18/simulinkNote/%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81%E6%95%B0%E6%8D%AE.png" srcset="/img/loading.gif" lazyload></p>
<p>​		输出的枚举类型可在Data Inspector与Scope中直接显示，也可以直接使用<code>double</code>模块强制转换为浮点数，通常会涉及到<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/slref/memory.html">Memory</a>这个模块，用来储存上一时刻的值。Stateflow还提供了操作符<code>in</code>来检查状态是否激活（尽量使用状态的完整名称），用法如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">in(state_name) <span class="hljs-comment">%若状态state_name激活返回1，反之为0</span><br></code></pre></td></tr></table></figure>

<h3 id="使用时序逻辑调度"><a href="#使用时序逻辑调度" class="headerlink" title="使用时序逻辑调度"></a>使用时序逻辑调度</h3><p>​		定义 Stateflow 图在仿真时间的行为，可在图的状态和转移动作中使用时序逻辑运算符。时间逻辑运算符是内置函数，告诉状态保持活动状态或布尔条件保持为真的时间长度。以下是最常见的绝对时间时序逻辑运算符：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ref/after.html">after</a> - 如果自包含该运算符的状态或包含该运算符的转移的源状态被激活以来经过的仿真时间达到 <code>n</code> 秒，则 <code>after(n,sec)</code> 返回 <code>true</code>。否则，运算符返回 <code>false</code>。此运算符支持以秒 (<code>sec</code>)、毫秒 (<code>msec</code>) 和微秒 (<code>usec</code>) 计的基于事件的时序逻辑和绝对时间时序逻辑。</li>
<li><a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/stateflow/ref/elapsed.html">elapsed</a> - <code>elapsed(sec)</code> 返回自关联状态激活以来经过的仿真时间的秒数，表达式 <code>elapsed(sec)</code> 和 <code>et</code> 等效于 <code>temporalCount(sec)</code>。</li>
<li><a href>duration</a> - <code>duration(C)</code> 返回自布尔条件 <code>C</code> 变为 <code>true</code> 以来经过的仿真时间的秒数。</li>
</ul>
<h2 id="Model-Linearizer"><a href="#Model-Linearizer" class="headerlink" title="Model Linearizer"></a><strong>Model Linearizer</strong></h2><p>​		使用 Model Linearizer，您可以分析线性化模型的时域和频域响应。您可以比较多个模型的响应并查看稳定裕度和稳定时间等系统特性。</p>
<p>参考官网链接:<a target="_blank" rel="noopener" href="https://ww2-mathworks-cn.translate.goog/help/slcontrol/ug/linearize-simulink-model.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">在模型工作点线性化Simulink 模型</a>,   <a target="_blank" rel="noopener" href="https://ww2-mathworks-cn.translate.goog/help/slcontrol/ug/analyze-results-using-linear-analysis-tool-response-plots-1.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">使用模型线性化器响应图分析结果使用模型线性化器响应图分析结果</a>  <a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/specify-portion-of-model-to-linearize-in-linear-analysis-tool.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">在模型线性化器中指定要线性化的模型部分</a></p>
<table>
<thead>
<tr>
<th></th>
<th>Simulink Control Design Linearization</th>
</tr>
</thead>
<tbody><tr>
<td>图形用户界面</td>
<td>是的。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/linearize-simulink-model.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">在模型工作点线性化 Simulink 模型</a>。</td>
</tr>
<tr>
<td>灵活定义模型的哪一部分进行线性化</td>
<td>是的。允许您以图形方式或编程方式在 Simulink 模型的任何级别指定线性化 I&#x2F;O 点，而无需修改您的模型。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/linearize-at-trimmed-operating-point.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">在修整的工作点进行线性化</a>。</td>
</tr>
<tr>
<td>开环分析</td>
<td>是的。允许您在不删除模型中的反馈信号的情况下打开反馈回路。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/open-loop-response-of-control-system-for-stability-margin-analysis.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">计算开环响应</a>。</td>
</tr>
<tr>
<td>控制线性模型状态排序</td>
<td>是的。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/state-order-in-linearized-model.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">线性化模型中的顺序状态</a>。</td>
</tr>
<tr>
<td>控制单个块的线性化</td>
<td>是的。允许您为模块和子系统指定自定义线性化行为。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/when-to-specify-individual-block-linearization.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">何时指定单个块线性化</a>。</td>
</tr>
<tr>
<td>线性化诊断</td>
<td>是的。识别有问题的块并让您检查每个块的线性化值。请参阅<a target="_blank" rel="noopener" href="https://www-mathworks-com.translate.goog/help/slcontrol/ug/linearization-troubleshooting-overview.html?_x_tr_sl=auto&_x_tr_tl=zh-CN&_x_tr_hl=zh-CN">线性化故障排除概述</a>。</td>
</tr>
<tr>
<td>块检测和减少</td>
<td>是的。块缩减检测对整体线性化没有贡献的块，从而产生最小实现。</td>
</tr>
<tr>
<td>多速率模型速率转换算法的控制</td>
<td>是的</td>
</tr>
</tbody></table>
<p>分析点类型：</p>
<ul>
<li><strong>Input Perturbation</strong> — Specifies an additive input to a signal.</li>
<li><strong>Output Measurement</strong> — Takes a measurement at a signal.</li>
<li><strong>Loop Break</strong> — Specifies a loop opening.</li>
<li><strong>Open-Loop Input</strong> — Specifies a loop break followed by an input perturbation.</li>
<li><strong>Open-Loop Output</strong> — Specifies an output measurement followed by a loop break.</li>
<li><strong>Loop Transfer</strong> — Specifies an output measurement before a loop break followed by an input perturbation.</li>
<li><strong>Sensitivity</strong> — Specifies an input perturbation followed by an output measurement.</li>
<li><strong>Complementary Sensitivity</strong> — Specifies an output measurement followed by an input perturbation</li>
</ul>
<p>​		若想要指定开环分析（屏蔽掉外环反馈），可利用Open-Loop Input&#x2F;Output，可以选择以下组合：1.  <strong>Open-Loop Input+Output Measurement</strong>  2. <strong>Input Perturbation+Output Measurement</strong></p>
<p>​		对选择的信号插入Input Point &#x2F; Output Point</p>
<ul>
<li><p>要指定要线性化的模型部分，首先打开线性化选项卡。为此，在Simulink 窗口的Apps 库中，点击Linearization Manager 。</p>
</li>
<li><p>要为信号指定分析点，请点击模型中的信号。然后，在“线性化”选项卡上的“插入分析点”库中，选择分析点的类型。</p>
</li>
<li><p>将分析的信号配置为Input Perturbation。将输出信号配置为Open-loop Output。开环输出点是在开环后进行的输出测量，它在不改变模型工作点的情况下消除了反馈信号对线性化的影响。要指定要线性化的模型部分，首先打开线性化选项卡。为此，在 Simulink 窗口的 Apps 库中，点击 Linearization Manager 。</p>
</li>
</ul>
<p>​     Model Linearize进入绘制波特图</p>
<p>实例：</p>
<p><img src="/2024/03/18/simulinkNote/image-20230619190121382.png" srcset="/img/loading.gif" lazyload alt="image-20230619190121382"></p>
<h2 id="Matlab中的C-MEX函数"><a href="#Matlab中的C-MEX函数" class="headerlink" title="Matlab中的C++MEX函数"></a>Matlab中的C++MEX函数</h2><p>​		C++与Matlab的混合使用，matlab调用c++的动态链接库或者使用C++MEX函数调用Matlab等可以参看<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/cpp-language.html?s_tid=CRUX_lftnav">官方链接</a>。MEX函数是可以自动加载，可以像任何 MATLAB 函数一样调用的程序，C++MEX其主要依靠<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/matlab-data-array.html">MATLAB Data API</a>与<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/cpp-engine-api.html">MATLAB C++ Engine API</a>，前者提供了C++接口来处理MATLAB数据，后者提供了C++11及串联Matlab的诸多功能处理(如使用<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/apiref/matlab.engine.matlabengine_cpp.html">matlab::engine::MATLABEngine</a>调用matlab函数)。</p>
<p>​		C++MEX函数必须继承基类 <a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/apiref/matlab.mex.function.html"><code>matlab::mex::Function</code></a>且名称为 <code>MexFunction</code>的子类，并重写函数调用运算符 <code>operator()</code>；MEX 函数的输入和输出作为<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/apiref/matlab.mex.argumentlist.html"><code>matlab::mex::ArgumentList</code></a> 中的元素进行传递，如下是一个简单的示意：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* MyMEXFunction annotation</span><br><span class="hljs-comment"> * c = MyMEXFunction(a,b);</span><br><span class="hljs-comment"> * Adds offset argument a to each element of double array b and</span><br><span class="hljs-comment"> * returns the modified array c.</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mex.hpp&quot;</span>   <span class="hljs-comment">// Include this file for the C++ MEX API.</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mexAdapter.hpp&quot;</span>  <span class="hljs-comment">// Utility needed for C++ MEX function operator</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> matlab::data;   <br><span class="hljs-keyword">using</span> matlab::mex::ArgumentList; <span class="hljs-comment">// input output data type</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MexFunction</span> : <span class="hljs-keyword">public</span> matlab::mex::Function &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(ArgumentList outputs, ArgumentList inputs)</span> </span>&#123;<br>        <span class="hljs-built_in">checkArguments</span>(outputs, inputs);<br>        <span class="hljs-type">const</span> <span class="hljs-type">double</span> offSet = inputs[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>        TypedArray&lt;<span class="hljs-type">double</span>&gt; doubleArray = std::<span class="hljs-built_in">move</span>(inputs[<span class="hljs-number">1</span>]);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; elem : doubleArray) &#123;<br>            elem += offSet;<br>        &#125;<br>        outputs[<span class="hljs-number">0</span>] = doubleArray;<br>    &#125;<br>     <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkArguments</span><span class="hljs-params">(ArgumentList outputs, ArgumentList inputs)</span> </span>&#123;<br>        <span class="hljs-comment">// Get pointer to engine</span><br>        std::shared_ptr&lt;matlab::engine::MATLABEngine&gt; matlabPtr = <span class="hljs-built_in">getEngine</span>();<br>        <span class="hljs-comment">// Get array factory: matlab::data::ArrayFactory Create arrays</span><br>        ArrayFactory factory;<br>        <span class="hljs-comment">// Check offset argument: First input must be scalar double</span><br>        <span class="hljs-keyword">if</span> (inputs[<span class="hljs-number">0</span>].<span class="hljs-built_in">getType</span>() != ArrayType::DOUBLE || inputs[<span class="hljs-number">0</span>].<span class="hljs-built_in">getNumberOfElements</span>() != <span class="hljs-number">1</span> || inputs[<span class="hljs-number">1</span>].<span class="hljs-built_in">getType</span>() != ArrayType::DOUBLE)<br>        &#123;<br>            matlabPtr-&gt;<span class="hljs-built_in">feval</span>(<span class="hljs-string">u&quot;error&quot;</span>,<span class="hljs-number">0</span>,<br>                std::<span class="hljs-built_in">vector</span>&lt;Array&gt;(&#123; factory.<span class="hljs-built_in">createScalar</span>(<span class="hljs-string">&quot;Input must be scalar double&quot;</span>) &#125;)); <span class="hljs-comment">// Call the error() using feval()</span><br>        &#125;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>​		然后使用 <code>mex</code> 命令编译 .cpp 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mex -setup C++  <span class="hljs-comment"># MEX选择c++的编译器</span><br>mex demoMEX.cpp <span class="hljs-comment"># 编译cpp文件生成二进制文件，Windows下为 .mexw64</span><br></code></pre></td></tr></table></figure>

<p>参考链接<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/matlab_external/c-mex-functions.html">C++ MEX 函数</a>，<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/511253062">知乎S-function使用</a>，<a target="_blank" rel="noopener" href="https://blog.smileland.me/2020/02/12/%E4%BD%BF%E7%94%A8C%E8%AF%AD%E8%A8%80%E5%86%99%E7%AE%80%E5%8D%95S-Function/">2020-02-12-使用C语言写简单S-Function</a></p>
<h2 id="Simulink中的S-function"><a href="#Simulink中的S-function" class="headerlink" title="Simulink中的S-function"></a>Simulink中的S-function</h2><p>​		S-Function属于simulink中的用户自定义模块，是用 MATLAB、C、C++ 或 Fortran  编写的 Simulink 模块的计算机语言描述。使用 mex 实用程序编译为 MEX 文件。S-Function 遵循一般形式，可以适应连续、离散和混合系统。通过遵循一组简单的规则，您可以在 S-Function 中实现算法，并使用  S-Function 模块将其添加到 Simulink 模型。在编写 S-Function 并将其名称放入 S-Function 模块后，您可以使用封装来自定义用户界面（请参阅<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/block-masks.html">Author Block Masks</a>）。</p>
<p>​		S-Function 定义模块在仿真的不同部分（例如初始化、更新、求导、输出和终止）的行为。Level-2 MATLAB S-function是新版simulink引入的升级版，提供了更多的功能与方法。二者均可以在对应模块窗口定义传递参数，各参数以逗号分割。</p>
<p>​		level-1S-Function的通常形式为<code>[sys,x0,str,ts]=f(t,x,u,flag,p1,p2,...)</code>，式中系统根据<code>flag</code>调用不同方法，对应关系如下：</p>
<table>
<thead>
<tr>
<th>Level-1 Flag</th>
<th>Level-2 Callback Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td><code>setup</code></td>
<td>定义基本 S-Function 块特征，包括采样时间、连续和离散状态的初始条件以及尺寸数组</td>
</tr>
<tr>
<td>1</td>
<td><code>mdlDerivatives</code></td>
<td>计算连续状态变量的导数</td>
</tr>
<tr>
<td>2</td>
<td><code>mdlUpdate</code></td>
<td>更新离散状态、采样时间和主要时间步要求</td>
</tr>
<tr>
<td>3</td>
<td><code>mdlOutputs</code></td>
<td>计算输出</td>
</tr>
<tr>
<td>4</td>
<td><code>mdlOutputs</code> 方法更新运行时对象的  <code>NextTimeHit</code> 属性</td>
<td>以绝对时间计算下一次hit的时间。仅当您在<code>setup</code>方法中指定可变离散时间采样时间时，才使用此例程。</td>
</tr>
<tr>
<td>9</td>
<td><code>mdlTerminate</code></td>
<td>执行任何必要的模拟结束任务</td>
</tr>
</tbody></table>
<p>在matlab官方文档中给出了sfundsc2.m转换为sfundsc2_level2.m的代码，可在下表对比：</p>
<table>
<thead>
<tr>
<th>Code in sfundsc2.m</th>
<th>Code in Level-2 MATLAB file (sfundsc2_level2.m)</th>
</tr>
</thead>
<tbody><tr>
<td><code>function [sys,x0,str,ts]= ...  sfundsc2(t,x,u,flag)</code></td>
<td><code>function sfundsc2(block)  setup(block);</code><br>语法发生更改以接受一个输入参数<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/slref/simulink.msfcnruntimeblock.html">block</a>，其是 Level-2 MATLAB S-Function 块的<strong>运行时间对象</strong>。 Level-2 MATLAB S-Function 的主体包含一行调用本地<code>setup</code>函数。</td>
</tr>
<tr>
<td><code>switch flag, case 0, [sys,x0,str,ts] = ...   mdlInitializeSizes;</code></td>
<td><code>function setup(block)</code><br> 标志位为0 调用<code>setup</code>方法，level-2不使用switch语句，本地<code>setup</code>函数会注册在模拟过程中直接调用回调方法。</td>
</tr>
<tr>
<td><code>case 2,   sys = mdlUpdate(t,x,u); case 3,   sys = mdlOutputs(t,x,u);</code></td>
<td><code>block.RegBlockMethod(&#39;Outputs&#39; ,@Output); block.RegBlockMethod(&#39;Update&#39;  ,@Update);</code> <br><code>setup</code>函数注册了两个局部函数，分别与标志值2和3关联。</td>
</tr>
<tr>
<td><code>sizes = simsizes; sizes.NumContStates  = 0; sizes.NumDiscStates  = 1; sizes.NumOutputs     = 1; sizes.NumInputs      = 1; sizes.DirFeedthrough = 0; sizes.NumSampleTimes = 1; sys = simsizes(sizes); x0  = 0; str = []; ts  = [.1 0];</code></td>
<td><code>setup</code>函数还初始化了MATLAB第2级s函数的属性:<br><code>block.NumInputPorts  = 1; block.NumOutputPorts = 1; block.InputPort(1).Dimensions        = 1; block.InputPort(1).DirectFeedthrough = false; block.OutputPort(1).Dimensions       = 1; block.NumDialogPrms     = 0; block.SampleTimes = [0.1 0];</code>由于此 S-Function 具有离散状态，因此 <code>setup</code> 方法会注册 <code>PostPropagationSetup</code> 回调方法来初始化 <code>DWork</code> 向量，并注册 <code>InitializeConditions</code> 回调方法来设置初始状态值。<code>block.RegBlockMethod(&#39;PostPropagationSetup&#39;,... @DoPostPropSetup); block.RegBlockMethod(&#39;InitializeConditions&#39;, ... @InitConditions);</code></td>
</tr>
<tr>
<td><code>sizes.NumDiscStates  = 1;</code></td>
<td><code>PostPropagationSetup</code>方法初始化存储单个离散状态的<code>DWork</code>向量。<br><code>function DoPostPropSetup(block)   %% Setup Dwork  block.NumDworks = 1;  block.Dwork(1).Name = &#39;x0&#39;;   block.Dwork(1).Dimensions      = 1;  block.Dwork(1).DatatypeID      = 0;  block.Dwork(1).Complexity      = &#39;Real&#39;;  block.Dwork(1).UsedAsDiscState = true; </code></td>
</tr>
<tr>
<td><code>x0  = 0;</code></td>
<td><code>PostPropagationSetup</code>方法初始化存储单个离散状态的<code>DWork</code>向量。<br><code>function InitConditions(block) %% Initialize Dwork  block.Dwork(1).Data = 0 </code></td>
</tr>
<tr>
<td><code>function sys = ...   mdlUpdate(t,x,u) sys = u;     </code></td>
<td><code>Update</code>方法计算离散状态的下一个值。<br><code>function Update(block) block.Dwork(1).Data = block.InputPort(1).Data; </code></td>
</tr>
<tr>
<td><code>function sys = ...   mdlOutputs(t,x,u) sys = x;</code></td>
<td><code>Outputs</code> 方法计算输出。<br><code>function Outputs(block) block.OutputPort(1).Data = block.Dwork(1).Data;</code></td>
</tr>
</tbody></table>
<p>​		A Level-2 MATLAB S-function必须包括<code>setup</code>与<code>Outputs</code>两个方法，其余方法及对应的C MEX函数可参考<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/sfg/writing-level-2-matlab-s-functions.html">writing-level-2-matlab-s-functions</a>，官方提供了一个MATLAB S-function模板文件<a href="edit('msfuntmpl_basic.m')">msfuntmpl_basic.m</a>，用来编写自己的程序(也可以使用sfundemos命令来查看内置的所有模板)。<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/sfg/dwork-matlab.html#brd2qpw">DWork</a>向量是 S-Function 要求 Simulink 引擎分配给模型中 S-Function 的每个实例的内存块，通常离散变量需使用它，其需在<code>PostPropagationSetup</code>方法中初始化向量维度与属性，在<code>Start</code> 或 <code>InitializeConditions</code> 方法中设定初值，且可在其余方法中调用。<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/simulink/sfg/s-function-concepts.html">S-Function Concepts</a>中介绍了直接馈通对代数环的影响，及采样时间偏移与可变数组的概念。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">msfcn_unit_delay</span><span class="hljs-params">(block)</span></span><br><span class="hljs-comment">% Level-2 MATLAB file S-Function for unit delay demo.</span><br>  setup(block);<br><span class="hljs-comment">%endfunction</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span><span class="hljs-params">(block)</span></span><br>  block.NumDialogPrms  = <span class="hljs-number">1</span>; <span class="hljs-comment">%对话框参数个数</span><br>  block.NumInputPorts  = <span class="hljs-number">1</span>;<br>  block.NumOutputPorts = <span class="hljs-number">1</span>; <span class="hljs-comment">%定义输入输出端口</span><br><br>  block.SetPreCompInpPortInfoToDynamic;<br>  block.SetPreCompOutPortInfoToDynamic;<span class="hljs-comment">%输入端口和输出端口从模型继承编译属性</span><br>  block.InputPort(<span class="hljs-number">1</span>).Dimensions        = <span class="hljs-number">1</span>;<br>  block.InputPort(<span class="hljs-number">1</span>).DirectFeedthrough = <span class="hljs-built_in">false</span>; <span class="hljs-comment">%无直接馈通</span><br>  block.OutputPort(<span class="hljs-number">1</span>).Dimensions       = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">%block.NumContStates = 1;% Set up the continuous states.</span><br>  <br>  block.SampleTimes = [<span class="hljs-number">0.1</span> <span class="hljs-number">0</span>];<span class="hljs-comment">%[-1 0]表示采用继承的采样时间 [0 0]连续采样时间</span><br>  <span class="hljs-comment">%% Set the block simStateCompliance to default (i.e., same as a built-in block)</span><br>  block.SimStateCompliance = <span class="hljs-string">&#x27;DefaultSimState&#x27;</span>;<br>  <span class="hljs-comment">%% 注册回调方法</span><br>  block.RegBlockMethod(<span class="hljs-string">&#x27;PostPropagationSetup&#x27;</span>, @DoPostPropSetup);<br>  block.RegBlockMethod(<span class="hljs-string">&#x27;InitializeConditions&#x27;</span>, @InitConditions);  <br>  block.RegBlockMethod(<span class="hljs-string">&#x27;Outputs&#x27;</span>, @Output);  <br>  block.RegBlockMethod(<span class="hljs-string">&#x27;Update&#x27;</span>,  @Update);  <br>  block.RegBlockMethod(<span class="hljs-string">&#x27;Derivatives&#x27;</span>, @Derivatives)<br><span class="hljs-comment">%endfunction</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DoPostPropSetup</span><span class="hljs-params">(block)</span></span><br>  <span class="hljs-comment">%% 初始化离散状态变量，不能在setup方法中初始化离散变量</span><br>  block.NumDworks = <span class="hljs-number">1</span>;<br>  block.Dwork(<span class="hljs-number">1</span>).Name = <span class="hljs-string">&#x27;x0&#x27;</span>; <br>  block.Dwork(<span class="hljs-number">1</span>).Dimensions      = <span class="hljs-number">1</span>;<br>  block.Dwork(<span class="hljs-number">1</span>).DatatypeID      = <span class="hljs-number">0</span>;<br>  block.Dwork(<span class="hljs-number">1</span>).Complexity      = <span class="hljs-string">&#x27;Real&#x27;</span>;<br>  block.Dwork(<span class="hljs-number">1</span>).UsedAsDiscState = <span class="hljs-built_in">true</span>;<br><span class="hljs-comment">%endfunction</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">InitConditions</span><span class="hljs-params">(block)</span>%初始化连续或离散<span class="hljs-title">DWork</span>变量的值</span><br>  block.Dwork(<span class="hljs-number">1</span>).Data = block.DialogPrm(<span class="hljs-number">1</span>).Data;<br>  <span class="hljs-comment">% block.ContStates.Data(1) = 1.0; %ContStates方法初始化连续变量</span><br><span class="hljs-comment">%endfunction</span><br><br><span class="hljs-comment">%% 连续变量必须声明Derivatives方法来设置导数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Derivatives</span><span class="hljs-params">(block)</span></span><br>	block.Derivatives.Data(<span class="hljs-number">1</span>) = block.InputPort(<span class="hljs-number">1</span>).Data;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Output</span><span class="hljs-params">(block)</span></span><br>  block.OutputPort(<span class="hljs-number">1</span>).Data = block.Dwork(<span class="hljs-number">1</span>).Data;<br><span class="hljs-comment">%endfunction</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Update</span><span class="hljs-params">(block)</span></span><br>  block.Dwork(<span class="hljs-number">1</span>).Data = block.InputPort(<span class="hljs-number">1</span>).Data;<br><span class="hljs-comment">%endfunction</span><br></code></pre></td></tr></table></figure>

<p>如下给出一个生成$\ddot{x} &#x3D; -25\dot{x}+133u(t)+d(t)$的Level-2 S-Function的示例：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chap2_7plantL2</span><span class="hljs-params">(block)</span></span><br><span class="hljs-comment">% Level-2 MATLAB file S-Function for \ddot&#123;x&#125; = -25\dot&#123;x&#125;+133u(t)+d(t)。</span><br>  setup(block);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span><span class="hljs-params">(block)</span></span><br>  block.NumDialogPrms  = <span class="hljs-number">0</span>; <span class="hljs-comment">%对话框参数个数</span><br>  block.NumInputPorts  = <span class="hljs-number">1</span>;<br>  block.NumOutputPorts = <span class="hljs-number">1</span>; <span class="hljs-comment">%定义输入输出端口</span><br>  block.SetPreCompInpPortInfoToDynamic;<br>  block.SetPreCompOutPortInfoToDynamic;<span class="hljs-comment">%输入端口和输出端口从模型继承编译属性</span><br>  block.InputPort(<span class="hljs-number">1</span>).Dimensions        = <span class="hljs-number">1</span>;<br>  block.InputPort(<span class="hljs-number">1</span>).DirectFeedthrough = <span class="hljs-built_in">false</span>; <span class="hljs-comment">%无直接馈通</span><br>  block.OutputPort(<span class="hljs-number">1</span>).Dimensions       = <span class="hljs-number">2</span>;<br>  block.NumContStates = <span class="hljs-number">2</span>;<span class="hljs-comment">% Set up the continuous states.</span><br>  block.SampleTimes = [<span class="hljs-number">-1</span> <span class="hljs-number">0</span>];<span class="hljs-comment">%[-1 0]表示采用继承的采样时间</span><br>  <span class="hljs-comment">%% Set the block simStateCompliance to default (i.e., same as a built-in block)</span><br>  block.SimStateCompliance = <span class="hljs-string">&#x27;DefaultSimState&#x27;</span>;<br>  <span class="hljs-comment">%% 注册回调方法</span><br>  block.RegBlockMethod(<span class="hljs-string">&#x27;InitializeConditions&#x27;</span>, @InitConditions);  <br>  block.RegBlockMethod(<span class="hljs-string">&#x27;Outputs&#x27;</span>, @Output);  <br>  block.RegBlockMethod(<span class="hljs-string">&#x27;Derivatives&#x27;</span>, @Derivatives)<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">InitConditions</span><span class="hljs-params">(block)</span>%初始化连续或离散<span class="hljs-title">DWork</span>变量的值</span><br>    block.ContStates.Data = [<span class="hljs-number">0</span> <span class="hljs-number">0</span>]; <span class="hljs-comment">%方法初始化连续变量</span><br><span class="hljs-comment">%% 连续变量必须声明Derivatives方法来设置导数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Derivatives</span><span class="hljs-params">(block)</span></span><br>    dt = <span class="hljs-number">50</span> * <span class="hljs-built_in">sin</span>(block.CurrentTime);      <br>	block.Derivatives.Data(<span class="hljs-number">1</span>) = block.ContStates.Data(<span class="hljs-number">2</span>);<br>    block.Derivatives.Data(<span class="hljs-number">2</span>) = <span class="hljs-number">-25</span>*block.ContStates.Data(<span class="hljs-number">2</span>)+<span class="hljs-number">133</span>*block.InputPort(<span class="hljs-number">1</span>).Data+dt;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Output</span><span class="hljs-params">(block)</span> </span><br>    block.OutputPort(<span class="hljs-number">1</span>).Data(<span class="hljs-number">1</span>)= block.ContStates.Data(<span class="hljs-number">1</span>);<br>    block.OutputPort(<span class="hljs-number">1</span>).Data(<span class="hljs-number">2</span>)= block.ContStates.Data(<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure>





<h2 id="fuzzyControl工具箱"><a href="#fuzzyControl工具箱" class="headerlink" title="fuzzyControl工具箱"></a>fuzzyControl工具箱</h2><h3 id="模糊推理系统GUI编辑器"><a href="#模糊推理系统GUI编辑器" class="headerlink" title="模糊推理系统GUI编辑器"></a>模糊推理系统GUI编辑器</h3><h4 id="GUI界面"><a href="#GUI界面" class="headerlink" title="GUI界面"></a>GUI界面</h4><p>在matlab命令行输入<code>fuzzy</code>即可进入FIS的GUI。</p>
<p>界面分为菜单条，模块区，模糊逻辑区与当前变量区。</p>
<blockquote>
<p>T-S与Mamdani型的模糊逻辑区与输出量框区存在差异</p>
</blockquote>
<p>熟悉编辑FIS输入，输出量的名称与维数。</p>
<p>Mamdani型的模糊逻辑区：</p>
<p><img src="/2024/03/18/simulinkNote/Mamdani%E6%A8%A1%E7%B3%8A%E9%80%BB%E8%BE%91%E7%AE%97%E6%B3%95.PNG" srcset="/img/loading.gif" lazyload></p>
<p>Sugeno型模糊逻辑区</p>
<p><img src="/2024/03/18/simulinkNote/T-S%E6%A8%A1%E7%B3%8A%E9%80%BB%E8%BE%91%E7%AE%97%E6%B3%95.PNG" srcset="/img/loading.gif" lazyload></p>
<h4 id="隶属函数编辑器"><a href="#隶属函数编辑器" class="headerlink" title="隶属函数编辑器"></a>隶属函数编辑器</h4><p>任意单击输入与输出量模框即可进入MF编辑器。</p>
<h5 id="Mamdani型MF的编辑"><a href="#Mamdani型MF的编辑" class="headerlink" title="Mamdani型MF的编辑"></a>Mamdani型MF的编辑</h5><ol>
<li><p>编辑输入&#x2F;出变量的论域(Range)与显示范围(Dispaly Range)。</p>
</li>
<li><p>增加覆盖输入&#x2F;出量模糊子集的数目。</p>
</li>
<li><p>修改隶属函数曲线：命名，MF类型，非标准函数型MF的修编(拖动拐点与修改参数)</p>
</li>
<li><p>修改模糊子集位置：拖动法</p>
</li>
</ol>
<h5 id="Sugeno型MF的编辑"><a href="#Sugeno型MF的编辑" class="headerlink" title="Sugeno型MF的编辑"></a>Sugeno型MF的编辑</h5><p>两种类型推理的输出结论不大相同，前者输出模糊子集，而后者模糊推理输出的是线性函数。</p>
<p><img src="/2024/03/18/simulinkNote/T-S%E5%9E%8BMF%E8%BE%93%E5%87%BA%E7%95%8C%E9%9D%A2.PNG" srcset="/img/loading.gif" lazyload></p>
<h4 id="模糊规则编辑器"><a href="#模糊规则编辑器" class="headerlink" title="模糊规则编辑器"></a>模糊规则编辑器</h4><p>输入量与输出量间的模糊蕴含关系R，用F条件命题对他们进行表述。</p>
<ol>
<li><p>Edit与Options的子菜单列表</p>
<table>
<thead>
<tr>
<th>edit</th>
<th>Options</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Undo</td>
<td>Language</td>
<td>Format</td>
</tr>
<tr>
<td>FIS properties…(调出FIS编辑器)</td>
<td>English</td>
<td>Verbose(语言型)</td>
</tr>
<tr>
<td>Membership Functions…(调出MF编辑器)</td>
<td>Deutsch</td>
<td>Symbolic</td>
</tr>
<tr>
<td>Anfis</td>
<td>Francais</td>
<td>Indexed</td>
</tr>
</tbody></table>
</li>
<li><p>模糊规则的编辑方法</p>
</li>
</ol>
<p>点击Edit-Membership或输入&#x2F;出框图进入隶属函数编辑器，即可通过点击不同的模糊子集与功能键实现输出与输出模糊子集的添加，删除与修改及论域的调整。</p>
<p>点击Edit-Rules或中间的规则框图即可进入模糊规则编辑器。</p>
<h4 id="模糊规则观测窗"><a href="#模糊规则观测窗" class="headerlink" title="模糊规则观测窗"></a>模糊规则观测窗</h4><p>点击View-Rules即可进入模糊规则观测窗，可以看到不同输入后的模糊推理与清晰化结果。</p>
<p>点击上面的surface则可看到模糊规则的三维图</p>
<h3 id="模糊控制系统的设计与仿真"><a href="#模糊控制系统的设计与仿真" class="headerlink" title="模糊控制系统的设计与仿真"></a>模糊控制系统的设计与仿真</h3><h4 id="FIS与Simulink的连接"><a href="#FIS与Simulink的连接" class="headerlink" title="FIS与Simulink的连接"></a>FIS与Simulink的连接</h4><p> 一般使用<strong>Fuzzy Logic Controller</strong>,右键点击“<strong>Look Under Mask</strong>”即可看到内部结构，使用时需要把使用GUI编辑的FIS结构文件嵌入模块。</p>
<ol>
<li>送入工作空间在嵌入</li>
<li>保存到文件在嵌入</li>
</ol>
<h4 id="构建模糊控制系统的仿真模型图"><a href="#构建模糊控制系统的仿真模型图" class="headerlink" title="构建模糊控制系统的仿真模型图"></a>构建模糊控制系统的仿真模型图</h4><ol>
<li>构建FIS结构文件</li>
<li>构建仿真模型图</li>
<li>进行仿真</li>
</ol>
<p>熟悉常用模块</p>
<h4 id="通过仿真对系统进行分析"><a href="#通过仿真对系统进行分析" class="headerlink" title="通过仿真对系统进行分析"></a>通过仿真对系统进行分析</h4><p>有许许多多的模糊模型仿真示例</p>
<p><img src="/2024/03/18/simulinkNote/MATLAB%E6%A8%A1%E7%B3%8A%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F%E7%A4%BA%E4%BE%8B.PNG" srcset="/img/loading.gif" lazyload></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="../../../../tags/simulink/">#simulink</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>simulinkNote</div>
      <div>http://example.com/2024/03/18/simulinkNote/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>szy</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月18日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="../../../../2023/06/07/ssh-deploy/" title="ssh deploy">
                        <span class="hidden-mobile">ssh deploy</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="../../../../js/events.js" ></script>
<script  src="../../../../js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="../../../../js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="../../../../js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="../../../../js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
